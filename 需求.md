# 虚拟足鞋适配系统需求文档

## 1. 项目介绍

虚拟足鞋适配系统是一款用于模拟和分析足部与鞋内腔之间适配情况的软件工具。该系统通过导入足部三维扫描模型、鞋内腔模型、PPT数据以及面料顶破实验数据，计算并可视化足鞋之间的干涉和压力分布，提供专业的足鞋适配分析。

## 2. 功能需求

### 2.1 数据导入

- **足部三维扫描模型**：支持导入WRL格式的足部三维扫描模型。
- **特征点坐标文件**：导入与足部模型对应的特征点坐标信息。
- **鞋内腔模型**：支持导入带有顶点组信息的鞋内腔模型。
- **PPT数据**：导入依附于标准足部模型的PPT（全足疼痛敏感性）数据。
- **面料顶破数据**：导入鞋内腔不同分区的面料球杆顶破实验数据（力-位移曲线）。

### 2.2 模型对齐

- **鞋内腔模型与足部模型对齐**：保持足部模型坐标系不变，仅对齐鞋内腔模型。
- **特征点对齐**：使用两个模型上各3个对应的特征点进行初始对齐，并进行精准微调。

### 2.3 足部模型变形

- **鞋底区域形态分析**：分析鞋内腔模型鞋底区域的形态特征（曲度）。
- **足部模型变形**：根据鞋底形态特征对足部模型进行变形，以贴合鞋内腔底面形态。
- **标记点坐标更新**：基于变形矩阵，对足部模型各标记点坐标进行变换和更新。

### 2.4 PPT数据映射

- **PPT数据变换**：将PPT数据的坐标根据变换矩阵进行变换。
- **PPT数据映射**：将变换后的PPT数据映射到用户足部扫描模型的对应表面。

### 2.5 干涉分析

- **初始干涉分析**：进行用户足部模型与鞋内腔模型的位置初始干涉分析，得到初始干涉云图。
  - 基于网格密度的模型简化
  - 计算足部模型到鞋内腔的距离
  - 生成距离云图和法向连接线
  - 支持交互式查看
- **距离计算流程**：
  1. 加载并显示原始模型信息（面片数、表面积、网格密度）
  2. 简化鞋内腔模型，使其网格密度与足部模型相近
  3. 计算每个足部面片到最近鞋内腔面片的距离
  4. 将距离值限制在有效范围内（-12.5mm到25mm）
  5. 使用jet颜色方案显示距离云图
  6. 显示有效区域的法向连接线
- **可视化要求**：
  - 使用jet颜色方案进行距离映射
  - 小于-12.5mm的区域显示为浅灰色
  - 显示足部面片中心到最近鞋内腔面片中心的连接线
  - 连接线颜色与云图颜色对应
  - 提供颜色条显示距离范围
- **压力值转换**：根据鞋内腔模型材质分区，依据不同分区的面料顶破实验曲线，将干涉值转换为压力值。
- **舒适性云图**：依据映射到目标足部模型的PPT数据，判断不同部位压力是否达到疼痛耐受阈值，给出最终的舒适性云图。

## 3. 技术需求

### 3.1 系统架构

- **数据处理模块**：负责模型加载、数据验证和预处理。
- **配准映射模块**：实现模型配准和数据映射。
- **计算分析模块**：执行适配计算和变形分析。
- **可视化模块**：负责三维模型渲染和结果可视化。
- **用户界面模块**：提供交互操作界面。

### 3.2 算法需求

- **ICP配准算法**：用于模型之间的自动配准。
- **空间插值算法**：用于PPT数据的映射和插值。
- **距离计算算法**：计算足部与鞋内腔之间的最近距离。
- **材料变形模型**：基于材料属性计算变形量。

### 3.3 性能需求

- **计算速度**：完整分析流程在普通计算机上应在3分钟内完成。
- **内存占用**：峰值内存占用不超过4GB。
- **可视化性能**：3D渲染应流畅，无明显卡顿。

## 4. 用户界面需求

- **布局设计**：左侧控制面板，右侧四分屏显示区域。
- **控制功能**：文件选择、参数设置、运行分析、结果查看。
- **交互方式**：支持鼠标旋转、缩放视图。
- **日志显示**：实时显示运行日志。

## 5. 数据需求

- **足部模型**：WRL格式的足部三维扫描模型。
- **鞋内腔模型**：带有顶点组信息的鞋内腔模型。
- **PPT数据**：依附于标准足部模型的PPT数据。
- **面料顶破数据**：鞋内腔不同分区的面料球杆顶破实验数据。

## 6. 系统约束

- **运行环境**：Windows 10/11操作系统。
- **依赖库**：Python 3.6+，PyQt5，VTK，NumPy，SciPy，Pandas，Trimesh。

## 7. 异常处理

- **文件缺失**：检测必要文件，报告缺失文件。
- **数据错误**：验证数据有效性，提供错误信息。
- **运行异常**：捕获异常并记录日志，避免程序崩溃。 